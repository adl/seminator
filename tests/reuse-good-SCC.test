#!/bin/sh
set -e

cat >reuse-good-SCC.hoa <<EOF
HOA: v1
States: 7
Start: 0
AP: 3 "a" "b" "c"
acc-name: generalized-Buchi 2
Acceptance: 2 Inf(0)&Inf(1)
properties: trans-labels explicit-labels trans-acc stutter-invariant
--BODY--
State: 0
[!0&!1&!2 | 0&1&!2] 0 {0 1}
[!0&!1&2 | 0&1&2] 1
[!0&1&2] 2
[!0&1&2 | 0&!1&2] 3
[!0&1&2 | 0&!1&2] 4
State: 1
[!0&!1&2] 1 {0}
[0&1&2] 1
[!0&!1&!2] 5 {0 1}
[0&1&!2] 5 {1}
State: 2
[!0&1&2 | 0&1&!2] 2 {0 1}
State: 3
[!0&1&2 | 0&1&!2] 2
[!0&!1&!2 | !0&1&2 | 0&!1&2 | 0&1&!2] 3
State: 4
[!0&1&2] 2
[!0&1&2 | 0&!1&2] 3
[!0&1&2 | 0&!1&2] 4 {0 1}
State: 5
[!0&!1&2] 1 {0}
[0&1&2] 1
[!0&!1&!2] 5 {0 1}
[0&1&!2] 5 {1}
[!0&1&2 | 0&!1&2] 6
State: 6
[!0&1&2] 6 {1}
[0&!1&2] 6 {0 1}
--END--
EOF

cat >reuse-good-SCC.expect <<EOF
HOA: v1
States: 11
Start: 0
AP: 3 "a" "b" "c"
acc-name: generalized-Buchi 2
Acceptance: 2 Inf(0)&Inf(1)
properties: trans-labels explicit-labels trans-acc semi-deterministic
--BODY--
State: 0 "0"
[!0&!1&!2 | 0&1&!2] 0
[!0&1&2 | 0&!1&2] 1
[!0&1&2 | 0&!1&2] 2
[!0&!1&!2 | 0&1&!2] 3
[!0&!1&2 | 0&1&2] 4
[!0&1&2] 5
State: 1 "3"
[!0&!1&!2 | !0&1&2 | 0&!1&2 | 0&1&!2] 1
[!0&1&2 | 0&1&!2] 5
State: 2 "4"
[!0&1&2 | 0&!1&2] 1
[!0&1&2 | 0&!1&2] 2
[!0&1&2] 5
[!0&1&2 | 0&!1&2] 6
State: 3 "{0} , ∅ , 0"
[!0&!1&!2 | 0&1&!2] 7 {0 1}
State: 4 "1"
[!0&!1&2] 4 {0}
[0&1&2] 4
[!0&!1&!2] 8 {0 1}
[0&1&!2] 8 {1}
State: 5 "2"
[!0&1&2 | 0&1&!2] 5 {0 1}
State: 6 "{4} , ∅ , 0"
[!0&1&2 | 0&!1&2] 9 {0 1}
State: 7 "{0} , ∅ , 1"
[!0&!1&!2 | 0&1&!2] 3 {0 1}
State: 8 "5"
[!0&!1&2] 4 {0}
[0&1&2] 4
[!0&!1&!2] 8 {0 1}
[0&1&!2] 8 {1}
[!0&1&2 | 0&!1&2] 10
State: 9 "{4} , ∅ , 1"
[!0&1&2 | 0&!1&2] 6 {0 1}
State: 10 "6"
[!0&1&2] 10 {1}
[0&!1&2] 10 {0 1}
--END--
EOF

cat >reuse-good-SCC.cd.expect <<EOF
HOA: v1
States: 11
Start: 0
AP: 3 "a" "b" "c"
acc-name: generalized-Buchi 2
Acceptance: 2 Inf(0)&Inf(1)
properties: trans-labels explicit-labels trans-acc semi-deterministic
--BODY--
State: 0 "{0}"
[!0&!1&!2 | 0&1&!2] 0
[!0&1&2 | 0&!1&2] 1
[!0&!1&!2 | 0&1&!2] 3
[!0&!1&2 | 0&1&2] 4
[!0&1&2] 5
State: 1 "{3,4}"
[!0&1&2 | 0&!1&2] 1
[!0&!1&!2 | 0&1&!2] 2
[!0&1&2 | 0&1&!2] 5
[!0&1&2 | 0&!1&2] 6
State: 2 "{3}"
[!0&!1&!2 | !0&1&2 | 0&!1&2 | 0&1&!2] 2
[!0&1&2 | 0&1&!2] 5
State: 3 "{0} , ∅ , 0"
[!0&!1&!2 | 0&1&!2] 7 {0 1}
State: 4 "1"
[!0&!1&2] 4 {0}
[0&1&2] 4
[!0&!1&!2] 8 {0 1}
[0&1&!2] 8 {1}
State: 5 "2"
[!0&1&2 | 0&1&!2] 5 {0 1}
State: 6 "{4} , ∅ , 0"
[!0&1&2 | 0&!1&2] 9 {0 1}
State: 7 "{0} , ∅ , 1"
[!0&!1&!2 | 0&1&!2] 3 {0 1}
State: 8 "5"
[!0&!1&2] 4 {0}
[0&1&2] 4
[!0&!1&!2] 8 {0 1}
[0&1&!2] 8 {1}
[!0&1&2 | 0&!1&2] 10
State: 9 "{4} , ∅ , 1"
[!0&1&2 | 0&!1&2] 6 {0 1}
State: 10 "6"
[!0&1&2] 10 {1}
[0&!1&2] 10 {0 1}
--END--
EOF


seminator --pure --reuse-good-SCC reuse-good-SCC.hoa > reuse-good-SCC.out
seminator --pure --reuse-good-SCC --cd reuse-good-SCC.hoa > reuse-good-SCC.cd.out
cat reuse-good-SCC.out
cat reuse-good-SCC.cd.out
diff reuse-good-SCC.out reuse-good-SCC.expect
diff reuse-good-SCC.cd.out reuse-good-SCC.cd.expect

rm -f reuse-good-SCC.hoa reuse-good-SCC.out reuse-good-SCC.expect reuse-good-SCC.cd.out reuse-good-SCC.cd.expect

